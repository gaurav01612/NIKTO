<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Analytics | Live Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg: #0d1117;
            --card: #161b22;
            --border: #30363d;
            --text: #c9d1d9;
            --blue: #58a6ff;
            --yellow: #d29922;
            --red: #f85149;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Segoe UI', Tahoma, sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container { max-width: 1200px; margin: 0 auto; }

        /* Stats Numbering Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card span {
            display: block;
            font-size: 12px;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .stat-card div {
            font-size: 32px;
            font-weight: bold;
        }

        /* Chart Section */
        .chart-container {
            background: var(--card);
            border: 1px solid var(--border);
            padding: 25px;
            border-radius: 10px;
            height: 450px;
        }

        .header {
            margin-bottom: 20px;
            border-left: 4px solid var(--blue);
            padding-left: 15px;
        }
        
        .header h1 { margin: 0; font-size: 20px; color: #fff; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>Phishing Intelligence Report</h1>
    </div>

    <div class="stats-grid">
        <div class="stat-card" style="border-bottom: 3px solid var(--blue);">
            <span>Total Opened</span>
            <div id="num-opens" style="color: var(--blue);">0</div>
        </div>
        <div class="stat-card" style="border-bottom: 3px solid var(--yellow);">
            <span>Total Clicked</span>
            <div id="num-clicks" style="color: var(--yellow);">0</div>
        </div>
        <div class="stat-card" style="border-bottom: 3px solid var(--red);">
            <span>Credentials Captured</span>
            <div id="num-subs" style="color: var(--red);">0</div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="barChart"></canvas>
    </div>
</div>

<script>
    let myChart;

    async function updateDashboard() {
        const res = await fetch('/data');
        const data = await res.json();

        // Update Numbers
        document.getElementById('num-opens').innerText = data.opens.reduce((a, b) => a + b, 0);
        document.getElementById('num-clicks').innerText = data.clicks.reduce((a, b) => a + b, 0);
        document.getElementById('num-subs').innerText = data.submissions.reduce((a, b) => a + b, 0);

        const ctx = document.getElementById('barChart').getContext('2d');
        if (myChart) myChart.destroy();

        myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: data.names,
                datasets: [
                    {
                        label: 'Opened',
                        data: data.opens,
                        backgroundColor: '#58a6ff',
                        barPercentage: 0.4, // Patle bars
                        categoryPercentage: 0.7,
                        borderRadius: 5
                    },
                    {
                        label: 'Clicked',
                        data: data.clicks,
                        backgroundColor: '#d29922',
                        barPercentage: 0.4,
                        categoryPercentage: 0.7,
                        borderRadius: 5
                    },
                    {
                        label: 'Captured',
                        data: data.submissions,
                        backgroundColor: '#f85149',
                        barPercentage: 0.4,
                        categoryPercentage: 0.7,
                        borderRadius: 5
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: '#8b949e' } }
                },
                scales: {
                    y: { 
                        beginAtZero: true, 
                        grid: { color: '#30363d' }, 
                        ticks: { color: '#8b949e', stepSize: 1 } 
                    },
                    x: { 
                        grid: { display: false }, 
                        ticks: { color: '#8b949e' } 
                    }
                }
            }
        });
    }

    updateDashboard();
    setInterval(updateDashboard, 10000);
</script>

</body>
</html>